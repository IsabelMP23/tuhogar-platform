<section class="overflow-visible">
  <div
    class="carousel-scroll flex gap-4 snap-x snap-mandatory scroll-smooth overflow-x-auto p-4 cursor-grab"
  >
    <slot />
  </div>
</section>

<style>
  .carousel-scroll {
    -ms-overflow-style: none;
    scrollbar-width: none;
  }
  .carousel-scroll::-webkit-scrollbar {
    display: none;
  }

  .carousel-scroll img {
    -webkit-user-drag: none;
    user-drag: none;
    -moz-user-select: none;
  }
  .cursor-grab { cursor: grab; }
  .cursor-grabbing { cursor: grabbing; }
</style>

<script>
  (function () {
    function setupCarousels() {
      document.querySelectorAll('.carousel-scroll').forEach((el) => {
        const container = el as HTMLElement;
        if (container.dataset.carouselInit === 'true') return;
        container.dataset.carouselInit = 'true';

        const items = container.children.length;
        if (items <= 3) {
          container.classList.add('xl:grid', 'xl:grid-cols-3', 'xl:overflow-visible', 'cursor-default');
        }

        let isDown = false;
        let startX = 0;
        let scrollLeft = 0;

        container.addEventListener('mousedown', (e: MouseEvent) => {
          isDown = true;
          container.classList.add('cursor-grabbing');
          e.preventDefault();
          startX = e.pageX - container.getBoundingClientRect().left + container.scrollLeft;
          scrollLeft = container.scrollLeft;
        });

        container.addEventListener('mouseleave', () => {
          isDown = false;
          container.classList.remove('cursor-grabbing');
        });

        container.addEventListener('mouseup', () => {
          isDown = false;
          container.classList.remove('cursor-grabbing');
        });

        container.addEventListener('mousemove', (e: MouseEvent) => {
          if (!isDown) return;
          e.preventDefault();
          const x = e.pageX - container.getBoundingClientRect().left + container.scrollLeft;
          const walk = (x - startX) * 1;
          container.scrollLeft = scrollLeft - walk;
        });
        let touchStartX = 0;
        let touchScrollLeft = 0;
        container.addEventListener('touchstart', (e: TouchEvent) => {
          touchStartX = e.touches[0].pageX;
          touchScrollLeft = container.scrollLeft;
        }, { passive: true });
        container.addEventListener('touchmove', (e: TouchEvent) => {
          const x = e.touches[0].pageX;
          const walk = (x - touchStartX) * 1;
          el.scrollLeft = touchScrollLeft - walk;
        }, { passive: true });
      });
    }

    if (document.readyState === 'loading') {
      window.addEventListener('DOMContentLoaded', setupCarousels);
    } else {
      setupCarousels();
    }
  })();
</script>